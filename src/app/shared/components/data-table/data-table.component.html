<div class="data-table-container">
  <!-- Header with Global Search -->
  <div class="card shadow-sm mb-2">
    <div class="card-body p-2">
      <div class="row g-2 align-items-center">
        <div class="col-md-6">
          <h6 class="mb-0">Total Records: {{ filteredData.length }}</h6>
        </div>
        <div class="col-md-6 text-end">
          <input 
            type="text" 
            class="form-control form-control-sm d-inline-block" 
            style="width: 250px;"
            placeholder="Global Search..." 
            (input)="onSearchChange($event)">
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-hover mb-0">
          <thead class="table-light sticky-top">
            <tr>
              @for (column of columns; track column.field) {
                <th [style.width]="column.width" [class.sortable]="column.sortable">
                  <div class="d-flex align-items-center justify-content-between">
                    <span>{{ column.header }}</span>
                    <div class="d-flex align-items-center gap-1">
                      @if (column.filterable) {
                        <div class="dropdown">
                          <button 
                            class="btn btn-sm btn-link p-0 text-muted" 
                            type="button" 
                            data-bs-toggle="dropdown"
                            [class.text-primary]="activeFilters[column.field]"
                            (click)="$event.stopPropagation()">
                            <span style="font-size: 0.75rem;">üîΩ</span>
                            @if (activeFilters[column.field]) {
                              <span class="badge bg-primary ms-1" style="font-size: 0.5rem;">‚óè</span>
                            }
                          </button>
                          <div class="dropdown-menu dropdown-menu-end p-2" style="min-width: 200px;">
                            <div class="mb-2">
                              <label class="form-label small mb-1">Filter {{ column.header }}</label>
                              <input 
                                type="text" 
                                class="form-control form-control-sm" 
                                [formControl]="$any(filterForm.get(column.field))"
                                placeholder="Search..."
                                (click)="$event.stopPropagation()">
                            </div>
                            @if (activeFilters[column.field]) {
                              <button 
                                class="btn btn-sm btn-outline-secondary w-100" 
                                (click)="clearColumnFilter(column.field); $event.stopPropagation()">
                                Clear
                              </button>
                            }
                          </div>
                        </div>
                      }
                      @if (column.sortable) {
                        <button 
                          class="btn btn-sm btn-link p-0 text-muted" 
                          (click)="onSort(column.field); $event.stopPropagation()"
                          [class.text-primary]="sortState.field === column.field">
                          <span class="sort-icon">{{ getSortIcon(column.field) }}</span>
                          @if (!getSortIcon(column.field)) {
                            <span style="opacity: 0.3; font-size: 0.75rem;">‚áÖ</span>
                          }
                        </button>
                      }
                    </div>
                  </div>
                </th>
              }
            </tr>
          </thead>
          <tbody>
            @if (displayedData.length === 0) {
              <tr>
                <td [attr.colspan]="columns.length" class="text-center text-muted py-4">
                  No records found
                </td>
              </tr>
            } @else {
              @for (row of displayedData; track $index) {
                <tr [class.clickable]="rowLinkPath" [style.cursor]="rowLinkPath ? 'pointer' : ''" (click)="rowLinkPath && onRowClick(row)">
                  @for (column of columns; track column.field) {
                    <td>
                      @if (column.type === 'status') {
                        <span [class]="'badge ' + getStatusBadgeClass(getFieldValue(row, column.field))">
                          {{ getFieldValue(row, column.field) }}
                        </span>
                      } @else if (column.type === 'jobType') {
                        <span [class]="'badge ' + getJobTypeBadgeClass(getFieldValue(row, column.field))">
                          {{ getFieldValue(row, column.field) || '‚Äî' }}
                        </span>
                      } @else if (column.type === 'link' && column.linkPath && column.linkIdField) {
                        @if (getFieldValue(row, column.linkIdField) != null && getFieldValue(row, column.linkIdField) !== '') {
                          <a [routerLink]="[column.linkPath, getFieldValue(row, column.linkIdField)]"
                             class="text-primary text-decoration-none"
                             (click)="$event.stopPropagation()">
                            {{ getDisplayValue(row, column) }}
                          </a>
                        } @else {
                          {{ getDisplayValue(row, column) }}
                        }
                      } @else {
                        {{ getDisplayValue(row, column) }}
                      }
                    </td>
                  }
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="card shadow-sm mt-2">
    <div class="card-body p-2">
      <div class="row g-2 align-items-center">
        <div class="col-md-6">
          <div class="d-flex align-items-center gap-2">
            <span class="small text-muted">
              Showing {{ startRecord }}-{{ endRecord }} of {{ filteredData.length }} entries
            </span>
            <select 
              class="form-select form-select-sm" 
              style="width: auto;"
              [(ngModel)]="pageSize" 
              (change)="onPageSizeChange()">
              @for (size of pageSizeOptions; track size) {
                <option [value]="size">{{ size }}</option>
              }
            </select>
            <span class="small text-muted">per page</span>
          </div>
        </div>
        <div class="col-md-6">
          <nav>
            <ul class="pagination pagination-sm justify-content-end mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" (click)="goToPage(currentPage - 1)" style="cursor: pointer;">Previous</a>
              </li>
              @for (pageNum of getPageNumbers(); track pageNum) {
                @if (pageNum === '...') {
                  <li class="page-item disabled">
                    <span class="page-link">...</span>
                  </li>
                } @else {
                  <li class="page-item" [class.active]="pageNum === currentPage">
                    <a class="page-link" (click)="goToPage($any(pageNum))" style="cursor: pointer;">
                      {{ pageNum }}
                    </a>
                  </li>
                }
              }
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" (click)="goToPage(currentPage + 1)" style="cursor: pointer;">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

